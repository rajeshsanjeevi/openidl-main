pipeline {
    agent {
        node {
            label 'slave'
        }
    }
    tools {
        git 'git'
    }
    parameters {
        string description: 'Node Type (aais | analytics | carrier)', name: 'node_type', trim: true
        string description: 'Environment (dev | test | prod)', name: 'env', trim: true
        string description: 'Git Branch Name', name: 'git_branch', trim: true
        string description: 'Git Repository', name: 'git_repository', trim: true
        }
    stages{
        stage('Deploy-Apps'){
           steps {
                wrap([$class: 'AnsiColorBuildWrapper', colorMapName: "xterm"]) {
                    ansibleTower(
                        towerServer: 'AWX',
                        towerCredentialsId: 'AWX',
                        templateType: 'job',
                        jobTemplate: "deploy-openidl-applications",
                        jobType: "run",
                        towerLogLevel: 'full',
                        removeColor: false,
                        async: false,
                        importTowerLogs: true,
                        extraVars: """---
                        node_type: '${params.node_type}'
                        env: '${params.env}'
                        git_branch: '${params.git_branch}'
                        git_repository: '${params.git_repository}'
                        """
                        )
                }
            }
        }
    }
    post {
        success {
            echo "The openidl applications deployment action is successful"

        }
        failure {
            echo "The openidl applications deployment action is failed, Please investigate"

        }
    }
}

